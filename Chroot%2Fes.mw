<languages />
Chroot (Cambiar el directorio raíz) es una utilidad del sistema Unix que se emplea para cambiar el directorio raíz aparente de modo que se pueda crear un nuevo entorno separado lógicamente del sistema principal. Este nuevo entorno se conoce como una "jaula chroot". Un usuario que opere dentro de la jaula no puede ver ni acceder ficheros fuera del entorno en el que se le ha confinado.

Uno de los usos principales usos del enjaulamiento es crear un sistema Linux independiente encima del actual para realizar pruebas o compatibilidad del software. A menudo se ve como una alternativa ligera a la virtualización, ya que se puede correr sin la sobrecarga de un supervisor.

== Configurar el entorno ==
Lo primero que necesita cuando realice una nueva instalación es crear el directorio en el que residirá su jaula, por ejemplo en "/mnt/mijaula"

{{Cmd
|mkdir /mnt/mijaula
|cd /mnt/mijaula
}}

Si quiere montar una instalación ya existente desde una partición, puede hacer lo siguiente:

{{Cmd
|mkdir /mnt/mijaula
|mount /dev/DISPOSITIVO /mnt/mijaula
}}

Reemplace DISPOSITIVO por la partición que contiene su instalación.

Si ya tiene una instalación en un subdirectorio de la raíz en la que se encuentra, no tendrá que realizar los pasos indicados arriba.

==Desempaquetar los ficheros de sistema y el árbol Portage para una instalación nueva==
Si está construyendo una nueva instalación, el siguiente paso es descargar el stage3 y los ficheros tarball de Portage para colocarlos en la localización chroot. Para obtener más información sobre este proceso, lea las secciones 5a y 5b en el [http://www.gentoo.org/doc/es/handbook/handbook-amd64.xml?part=1&chap=5 Manual de Gentoo].

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mychroot
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mychroot/usr
}}

==Configuration==
Before entering the chroot we need to mount a number of directories.

{{RootCmd
|mount -o bind /dev /mnt/mijaula/dev
|mount -t proc none /mnt/mijaula/proc
|mount -o bind /sys /mnt/mijaula/sys
|mount -o bind /tmp /mnt/mijaula/tmp
}}

And will also need to copy over some basic configuration file from the host, do not copy over make.conf if you're using an existing installation.

{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage # If you use an existing installation, skip this command.
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

Once done we can then enter the chroot environment.

{{RootCmd
|chroot /mnt/mijaula /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

When creating a new installation, you can sync portage to make sure everything is up to date.

{{RootCmd
|emerge --sync
}}

The system is now ready. You can install software, mess with settings, test experimental packages and configurations without having any effect on your main system. To leave the chroot simply type "exit" or press Ctrl-D, this will return you back to your normal environment. Don't forget to umount directories you've mounted.

==Init scripts==
If you need to do this often, you can speed up the mounting of the directories needed for a chroot by using an init script:

{{File|/etc/init.d/mychroot||
 #!/sbin/runscript

 <!-- Translated above -->

 start() {
     ebegin "Mounting chroot directories"
     mount -o bind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
}

 stop() {
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
 }
}}

If you use a different directory or partition, add the necessary mounting commands in start() and change /mnt/chroot if you use a different name.

==See also==
* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Gentoo x86 Chroot Setup Guide]
* [http://www.gentoo.org/proj/en/base/amd64/howtos/index.xml?part=1&chap=2 32Bit Chroot Guide for Gentoo/AMD64]


[[Category:Core system]]
