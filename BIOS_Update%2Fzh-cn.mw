<languages />
硬件生产商经常会提供BIOS和固件的更新。要安装（经常被成为刷新）这些更新并不很简单，有时需要一些额外的工作。
{{Warning/zh-cn|如果硬件正常工作，通常不需要升级BIOS。如果升级出现问题，可能会造成你的BIOS永久性损害，并且你可能失去保修资格。}}

== 获取 BIOS ==

首先你需要确认主板生产商和型号。请检查计算机附带的用户手册，通常有你会发现所有需要的信息。

你也可以用 {{package|sys-apps/dmidecode}} 来获取一些信息。

{{RootCmd|dmidecode -t bios -t baseboard}}

最后，如果你可以直接查看主板，你也许会在主板上找到需要的信息。

{{Warning/zh-cn|直接查看电脑主板可能会导致失去保修！}}

在硬件厂商的网站进行搜索你会得到BIOS的更新文件，类型为zip，exe或者iso。 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== BIOS 选项 ==

很多 BIOS 有一个选项可以从外部记忆棒或者软盘读取二进制映像。你要做的就是进入 BIOS 设置并查找选项。

== 引导光盘 ==

通常硬件厂商会提供一个光盘镜像的下载，作为引导媒介。该文件应该以 .iso 为后缀，将此镜像刻录到一张空白的CD-R：

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note/zh-cn|两个包都提供 cdrecord 命令（你只需要安装其中的一个）: {{Package|app-cdr/cdrtools}} 和 {{Package|app-cdr/cdrkit}}}}

现在你可以在 BIOS 中选择从光盘启动，按照你的硬件厂商网站上的说明进行更新。

== FreeDOS 环境 ==

You can use FreeDOS to run the DOS-based BIOS utility from your manufacturer.  You must first create a custom FreeDOS image which includes the necessary BIOS tools, and then boot this image via one of the methods shown here.

Download FreeDOS and tools:

* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - download the fdboot.img file
* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ FreeDOS bootsector] - download the file sys-freedos-linux.zip
* The DOS-Flash program and new BIOS from your manufacturers website

=== Create Custom FreeDOS Image ===

First we need to install and download the required software and enable the loopback device in our kernel:

{{KernelBox|title=enable loopback device|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

If the module isn't loaded yet:

{{RootCmd|modprobe loop}}

Install required software:

{{Emerge|dev-lang/nasm|app-arch/unzip|sys-fs/dosfstools}}

Create an image file of ~20MB using dd (the name needs to be freedos.img if you will be replacing the one on the SystemRescueCD):

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

Write a file system to the image:

{{RootCmd|mkfs.msdos freedos.img}}

Write the bootsector to the image file:

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

Now we need to copy the FreeDOS files to our new image.<br>
Create the mountpoints:

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

Mount the original image:

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

Mount the new image:

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

Copy the FreeDOS system files to our new image:

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

Now you should also copy your flash program and the new BIOS to the image file:

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

Unmount both images:

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note|DOS can only display names up to a length of 8 characters, you probably want to rename some of the files}}

=== Using SystemRescueCD to boot FreeDOS ===

The SystemRescueCD comes with a version of FreeDOS, we can replace the original image and create a bootable memory stick which contains the needed programs to flash our BIOS.

==== Download SystemRescueCD and prepare LiveUSB ====

* [http://www.sysresccd.org/Download SystemRescueCD] - download the normal ISO image

==== Create Bootable Memory Stick ====

We use the default method to create the SystemRescueCD boot medium, the script {{Path|usb_inst.sh}} will guide through the installation.

{{Warning|This will delete any data on the memory stick}}

Create the folder in {{Path|/mnt}}:

{{RootCmd|mkdir /mnt/SysRescueCD}}

Mount the CD image:

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

Start the installation script:

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

Unmount the CD image:

{{RootCmd|umount /mnt/SysRescueCD}}

==== Replace the FreeDOS image ====

We are going to replace the original FreeDOS image on the SystemRescueCD memory stick.<br>
Mount the SystemRescueCD memory stick ({{Path|/dev/sdX1}} needs to be replaced by the device name of your memory stick):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

Replace the {{Path|freedos.img}} file:

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

Unmount the SystemRescueCD memory stick:

{{RootCmd|umount /mnt/SysRescueCD}}

=== Booting the FreeDOS image from GRUB directly ===

If you would like to boot FreeDOS without any external media, you can use the "memdisk" tool from syslinux to allow grub (or another bootloader) to boot your FreeDOS image directly.

{{Emerge|sys-boot/syslinux}}

Mount your {{Path|/boot}} partition (if needed):

{{RootCmd|mount /boot}}

Copy the memdisk binary, and your newly built FreeDOS image to {{Path|/boot}}:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

Edit {{Path|/boot/grub/grub.conf}} and add an entry for FreeDOS:

{{FileBox|filename=/boot/grub/grub.conf|title=Example grub.conf entry|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== BIOS Update ===

Restart and choose to boot from the USB memory stick OR your new grub entry. If using SystemRescueCD, in the GRUB command line type:

{{CodeBox|freedos}}

This should boot you into our new FreeDOS image and you are greeted by the DOS prompt:

{{CodeBox|C:\}}

Now you can start your BIOS update by following the manufacturers instructions. Some useful commands in DOS:
;cd <dir> : change to the directory
;dir : list the files in the current directory
;type : display the contents of a file

== flashrom ==

<!--T:88->
Your motherboard can support flashing via {{package|sys-apps/flashrom}} directly from your system. In this case only what you need is BIOS image. Please check first list of [http://flashrom.org/Supported_hardware supported hardware].

First we check our new BIOS image:

{{RootCmd|flashrom -v W7235IMS.1A0}}

If all OK, let's flash'em:

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== See also ==

* [[Bootable DOS USB stick]]

[[Category:Core system]]
