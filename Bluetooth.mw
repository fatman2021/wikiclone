{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
}}
This article describes the setup of '''bluetooth''' controllers.

== Installing ==

=== Prerequisites ===
Bluez ({{Package|net-wireless/bluez}}) uses [[udev]], so set it up first.

=== Kernel ===
You need [[USB]] and/or [[PC-Card]] support. Also you need to activate the following kernel options:
{{Kernel||<pre>
[*] Networking support  --->
    <*> Bluetooth subsystem support  --->
        
        Select options for Bluetooth applications, see table below:
        <*>   ...

            Bluetooth device drivers  --->

               Select a Bluetooth HCI driver, e.g.:
               <*> HCI USB driver (btusb)
</pre>}}

{| class="wikitable"
|+ Bluetooth applications
|-
! Option
! Driver
! Description
|-
| RFCOMM protocol support || rfcomm || [[Wikipedia:RFCOMM|RFCOMM]] is a requirement of the [[Wikipedia:OBEX|OBEX]]-file transfer, dialup connections and more bluetooth applications.
|-
| RFCOMM TTY support || - || Enables [[terminal emulator]] connections over RFCOMM.
|-
| BNEP protocol support || bnep || Enables network support, e.g. for the [[Wikipedia:Personal Area Network|PAN]] profile.
|-
| Multicast filter support || - || Enables multicast filter support.
|-
| Protocol filter support || - || Enables protocoll filter support.
|-
| HIDP protocol support || hidp || Enables input device support. See the [[Bluetooth Input devices]] article.
|}

=== Software ===
Portage knows the global USE flag ''bluetooth'' for enabling support for Bluetooth in other packages. Enabling this USE flag will pull in {{Package|net-wireless/bluez}} automatically:
{{File|/etc/portage/make.conf||
USE{{=}}"... bluetooth ..."
}}
The USE flags of bluez are:
{{USEflag|package=net-wireless/bluez
|alsa+yes
|consolekit+yes
|cups+yes
|debug
|gstreamer
|pcmcia
|readline+yes
|selinux++no
|test-programs
|usb+yes
}}

After setting this you want to update your system so the changes take effect:
{{Emerge|params+=--changed-use --deep|@world}}

== Configuration ==

=== Boot service ===
You can now start bluetooth:
{{RootCmd|/etc/init.d/bluetooth start}}
To start bluetooth at boot time, add it your default runlevel:
{{RootCmd|rc-update add bluetooth default}}

=== Permissions ===
If you have the USE flag '''''acl''''' enabled globally and are using [[ConsoleKit]] (i.e you're using a ''desktop'' [[profile]]) permissions to bluetooth devices will be handled automatically.

A broader solution is to add the user you want to be able to access bluetooth devices to the ''plugdev'' group:
{{RootCmd|gpasswd -a larry plugdev}}

=== Adapter Information ===
Check that your bluetooth adapter is working.
{{Cmd|hcitool dev|output=<pre>
Devices:
	hci1	00:02:72:2F:A9:33
	hci0	60:D8:19:B6:C3:1F
</pre>}}
Where hci0 is the first device ID and 60:D8:19:B6:C3:1F is the MAC address.
{{Note|In this case there are two adapters but only one is required.}}
{{Note|If no adapters are found. Check that your bluetooth adapter is enabled. This may be a physical switch or keyboard function key. {{Package|net-wireless/rfkill}} is helpful for determining and setting the state of wireless adapters.}}

== Usage ==

=== Device Attach/Pairing ===
Before a device can be used, it must be attached (''paired'' in Bluetooth-lingo). This is done by entering a PIN (or other code) on both devices.

{{Note|Some simple devices like headsets do not allow entering an arbitrary PIN, they always use the same one (usually 0000 or 9999). Check the manual of your device which is to be used.}}

In order to pair, you must first have the interaction agent active. Most desktop environments have bluetooth integration so will automatically support the interaction agent. For example, KDE has {{Package|net-wireless/bluedevil}}. 

=== Using simple-agent ===
Configuration can either be performed using the BlueZ test programs (available if you enable the test-programs USE flag for {{Package|net-wireless/bluez}}), or by using the D-Bus API. The first way is described here.


* Retrieve the address of the mouse. Most of the devices need you to press a special button, possibly for several seconds, to render them discoverable. 
{{Cmd|hcitool scan|output=<pre>
Scanning ...
	00:1F:20:1D:1B:4B	Bluetooth Laser Travel Mouse
</pre>}}
: Where 00:1F:20:1D:1B:4B is the MAC address for your device.


* Pair the device:
{{Cmd|simple-agent hci0 00:1F:20:1D:1B:4B|output=<pre>
RequestPinCode (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
Enter PIN Code: 0000
Release
New device (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
</pre>}}
: Enter a PIN and press {{Key|Enter}}, then enter the same PIN at the device. If you don't know the PIN, then it is probably 0000. It could be 1234.

{{Note|<br />
{{Cmd|simple-agent hci0 00:1F:20:1D:1B:4B|output=<pre>
dbus.exceptions.DBusException: org.bluez.Error.AlreadyExists: Already Exists
</pre>}}
: Means that you already have an interaction agent running on your system.}}


* Mark the device as trusted so it can connect automatically: 
{{Cmd|bluez-test-device trusted 00:1F:20:1D:1B:4B yes}}


* Devices are not trusted by default. You can check trust status by leaving off the "yes" from the previous command.
{{Cmd|bluez-test-device trusted 00:1F:20:1D:1B:4B|output=<pre>
1
</pre>}}
: "1" is trusted, "0" is not trusted.


* Connect the device (this only needs to be done once, it will be done automatically after that): 
{{Cmd|bluez-test-input connect 00:1F:20:1D:1B:4B}}


* Your device should now be paired. You are now ready to proceed.


== Desktop integration ==
* {{Package|net-wireless/bluedevil}} for [[KDE]]
* {{Package|net-wireless/blueman}} for [[GNOME]], [[Xfce]], GTK+

== See also ==
* [[Bluetooth Headset]]
* [[Bluetooth Input devices]]
* [[Bluetooth Network Aggregation Point]]
* [http://www.elstel.org/MobilePhone.html Bluetooth Pairing and Applications for Synchronizing Phone Numbers, SMS-messages, Phone Call Entries, your Calendar and Time; Tethering]
[[Category:Interfaces]]
