<languages />

Эта статья описывает ручную конфигурацию и настройку [[Kernel/ru|ядра Linux]]. Автоматический метод описан в статье [[genkernel]].

==Установка символьной ссылки==

Символьная ссылка {{Path|/usr/src/linux}} должна всегда указывать на исходные коды используемого в настоящий момент ядра. Это может быть сделано одним из трех способов:

;1. Установка исходных кодов ядра с активным [[USE flag|USE-флагом]] "symlink"
:Это заставит {{Path|/usr/src/linux}} указывать на исходный код заново устанавливаемого ядра. Если необходимо, символьная ссылка может быть изменена позже двумя следующими методами:

;2. Настройка символьной ссылки с помощью '''eselect''':

: {{RootCmd| eselect kernel list |
  |output=Available kernel symlink targets:<br/> &nbsp; [1] linux-3.3.8-gentoo *<br/> &nbsp; [2] linux-3.4.9-gentoo
}}

:Эта команда выводит доступные исходные коды ядра. Звездочкой отмечены выбранные исходные коды. Для того чтобы изменить исходные коды ядра, например выбрать второй пункт, сделайте следующее:

: {{RootCmd|eselect kernel set 2}}

;3. Установка символьной ссылки вручную:

: {{RootCmd|ln -sf /usr/src/linux-3.4.9-gentoo /usr/src/linux |
  |ls -l /usr/src/linux |
  |output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo}}
<!-- The output is the same as the target file in the ln command. -->

==Инструменты конфигурации==

Ядро предлагает несколько инструментов для собственной конфигурации:

; '''make config'''
: Конфигурация с помощью текстовых инструментов. Параметры запрашиваются один за другим. Необходимо отметить все параметры, доступ к предыдущим параметрам вне очереди невозможен.

; '''make menuconfig'''
: Графическое меню (только текстовый ввод). Вы можете перемещаться по меню и изменять параметры которые Вам нужны.

; '''make nconfig'''
:Графическое меню основанное на ncurses. Требуется установка {{Package|sys-libs/ncurses}}.

; '''make xconfig'''
: Графическое меню использующее Qt4. Требует установки пакета {{Package|dev-qt/qtgui}}.

; '''make gconfig'''
: Графическое меню использующее GTK+. Требует установки {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}} и {{Package|gnome-base/libglade}}.

; '''make oldconfig'''
Анализирует изменения параметров между версиями ядра и обновляет их чтобы создать новый файл .config для ядра.


Существует несколько сценариев создания смешанных конфигураций по умолчанию. Смотри:

{{RootCmd|make help}}

== Конфигурация ==

Эта статья описывает конфигурацию с использованием '''make menuconfig''', но процедура аналогична подобным для других меню.

{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Использование ===

В показываемом меню Ваша позиция отмечена синей строкой. С помощью клавиш перемещения курсора {{Key|up}} и {{Key|down}} Вы можете изменять позицию. Клавиши {{Key|left}} и {{Key|right}} проходят по строке меню внизу и определяют, что произойдет при нажатии клавиши {{Key|Enter}}. '''Select''' выбирает подменю - пункты меню оканчивающиеся с ''--->'' - , в то время как '''Exit''' выходит из подменю. Альтернативно, вы можете нажать клавишу {{Key|Esc}} дважды.

Пункты меню, начинающиеся со скобок, являются драйверами или частями системы, которые могут быть активированы.

; [ ], [*]
: Параметры в квадратных скобках могут быть включены и отключены. Звездочка отмечает пункты меню как включенные. Вы можете изменить значение клавишей {{Key|space}} или нажатием {{Key|Y}} ('''Y'''es) для активации или {{Key|N}} ('''N'''o) для деактивации пункта меню.
: Если параметр включен, выбранный драйвер будет собран внутри ядра и всегда будет доступен во время загрузки.

; < >, <M>, <*>
: Параметры в угловых скобках могут быть не только включены и отключены, но также и активированы как модули. (обозначенные буквой ''M''). Вы изменяете значение как и раньше и нажимаете клавишу {{Key|M}} для того чтобы активировать их как модуль.
: Смотри статью [[Kernel Modules]] для различия.

; {M}, {*}
: Параметры в фигурных скобках могут быть включены или включены в качестве модулей, но не могут быть отключены, потому что другой драйвер требует их включения в любом случае.

; -M-, -*-
: Параметры между дефисами включены в соответствии со способом, показанным ранее. Другого выбора нет.


Кроме того, некоторые пункты меню имеют метки в конце:

; (NEW)
: Это новый драйвер ядра и он может быть недостаточно стабилен.

; (EXPERIMENTAL)
: Это экспериментальный драйвер и, скорее всего, он недостаточно стабилен.

; (DEPRECATED)
: Этот драйвер не является рекомендуемым и не нужен в большинстве систем.

; (OBSOLETE)
: Этот драйвер является устаревшим и не должен быть активирован.


Большинство параметров имеют описание, которое можно посмотреть нажимая клавишу {{Key|H}} или выбирая в строке меню '''Help'''.

=== Выбор драйверов ===

Смотри статью [[hardware detection]] и статьи в категории [[:Category:Hardware|Hardware]].

=== Search modules ===
Within ''menuconfig'', you can use {{Key|/}} to search modules by keyboards.

== Build ==

After configuring the kernel you have to compile the kernel:

{{RootCmd|make}}

If you have a processor with multiple cores, you can let all the cores do the work. For this add the parameter '''-j(NUMBER_CORES +1)'''. For a dual core processor:

{{RootCmd|make -j3}}

== Setup ==

If activated drivers as modules, you have to install them:

{{RootCmd|make modules_install}}

The modules will be copied to a sub directory of {{Path|/lib/modules}}.

To install the actual kernel:

{{RootCmd|make install}}

This command executes '''/sbin/installkernel''', which is part of the {{Package|sys-apps/debianutils}} package. ''The new kernel is installed into {{Path|/boot//vmlinuz-{version}}}. If a symbolic link {{Path|/boot/vmlinuz}} already exists, it is refreshed by making a link from {{Path|/boot/vmlinuz}} to the new kernel, and the previously installed kernel is available as {{Path|/boot/vmlinuz.old}}.'' (''installkernel'' [[man page]]). The same for {{Path|config}} and {{Path|System.map}} files. These symlinks are handy, because they point always to the newest kernel without changing the file path (e.g. you can use them in the bootloader configuration).

== Bootloader ==

Change your [[bootloader]] configuration to pick up at boot the new kernel.

Finally restart your system with the new kernel.

[[Category:Kernel]]
