It took me almost 2 days to figure out how to install and boot Gentoo on my new UEFI laptop.

I basically followed: http://www.gentoo.org/doc/en/gentoo-x86-quickinstall.xml

The following are points where I diverged from that guide in order to have a working, bootable system.

First, there is no master boot record on a UEFI system.

Instead your BIOS loads a .efi file from a FAT32 partition that you tell it about (by issuing a command to it's firmware, we'll get to that later)

Here is how I created mine partitions. NOTE the way I wrote the mkpart commands ensures proper alignment on SSD drives. Change them at your own risk. (Can use align-check to see if you did it right):

{{RootCmd|parted /dev/sda}}
{{RootCmd|prompt=(parted)
|mkpart ESI fat32 0% 500m
|mkpart primary ext4 500m 100%
|set 1 boot on
|quit
}}
{{RootCmd
|mkfs.vfat -F 32 /dev/sda1
|mkfs.ext4 /dev/sda2
}}

Note that the 'boot' flag parted sets is NOT the same thing as the bootable flag in the old master boot record.
It's confusing that parted choose to use the same name, but they are different.

Now continue along with the quickinstall guide.

For the kernel configuration, make sure you specify the kernel options mentioned here: [[EFI stub kernel]]

Here are my steps:
{{RootCmd|cd /usr/src/linux
|make menuconfig
|make modules_install

|mkdir /boot
|mount /dev/sda1 /boot
|mkdir -p /boot/efi/boot
|cp arch/x86/boot/bzImage /boot/efi/boot/bootx64.efi

|emerge efibootmgr}}

Now the tricky part. In order to tell the BIOS about your new bootx64.efi, you need to have booted the system WITH UEFI.

Since you likely used a CDROM to boot the system, it is unlikely that you booted with UEFI. Sad face :(

What does work, is if you stick your new bootx64.efi file on a USB flash stick, the laptop will automatically find that and boot it.

So insert a USB stick, we'll pretend it comes up as /dev/sdd in the following code:

{{RootCmd|parted /dev/sdd}}
{{RootCmd|prompt=(parted)
|mklabel gpt
|mkpart esi fat32 0% 500m
|set 1 boot on
|quit
}}
{{RootCmd
|mkfs.vfat -F 32 /dev/sdd1
|mkdir /mnt/tmp && mount /dev/sdd1 /mnt/tmp

|mkdir -p /mnt/tmp/efi/boot

|cp arch/x86/boot/bzImage /mnt/tmp/efi/boot/bootx64.efi
|umount /mnt/tmp}}

Now reboot the box and hit F2 (or whatever) to enter the BIOS on boot.

In the UEFI list, choose to boot the new USB flash stick that should be showing up.

The kernel should load up and boot your sytem.

Now you can tell the BIOS about your bootx64.efi that is on the hard drive:

{{RootCmd|efibootmgr -c -d /dev/sda -p 1 -L Gentoo -l "\efi\boot\bootx64.efi"
|reboot}}

Now enter the BIOS again and you should see "Gentoo" in the list!

Congrats, it should now boot!

[[Category:Bootloaders]]
