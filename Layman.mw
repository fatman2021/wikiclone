'''The layman application is Gentoo's primary [[overlay]] management tool, offering centralized repository management for the end user.'''

With {{Package|app-portage/layman}} users can manage their overlays in a simple, centralized manner. The layman application provides an overview of available remote overlay repositories and allows the user to select one or more for his system. Once selected, the user can update the repositories (similar to '''emerge --sync'''), add his local overlays, and more.

== Using layman ==

=== Installing layman ===
Installing layman is a breeze. First check the USE flags that the layman package supports; most of the USE flags trigger which kinds of remote repository types layman supports (such as git repositories, cvs repositories ...). Then install the layman package
{{Emerge|app-portage/layman}}

Insert layman reference to /etc/portage/make.conf.
{{RootCmd|<nowiki>echo "source /var/lib/layman/make.conf" >> /etc/portage/make.conf</nowiki>}}

This will ensure that Portage, when asked, will also check the content of the various overlays managed by layman. In effect, it will set the PORTDIR_OVERLAY variable, so if you already define that one in /etc/portage/make.conf, make sure that you do not overwrite the value that layman already provides.

{{File|/etc/portage/make.conf|Ensuring that layman's PORTDIR_OVERLAY is not overwritten|<pre>
PORTDIR_OVERLAY="${PORTDIR_OVERLAY} ..."
</pre>}}

=== Using layman ===
The ''layman'' [[man page]] (see [[#External resources|External resources]]) provides a full overview of the available functions within layman. However, for most people, the following commands suffice for their overlay management activities.

To fetch & display a list of all the overlays, type:
{{RootCmd|layman -L}}

To add an overlay in the list, type:
{{RootCmd|layman -a <name>}}

To remove an overlay from the local list, type:
{{RootCmd|layman -d <name>}}

To update all overlays, type:
{{RootCmd|layman -S}}

=== Setting overlay priorities with layman ===
As each [[Overlay|overlay]] is assigned a unique priority, layman provides a simple way of defining priorities for overlays it manages. For more information about overlay priorities see [[Overlay#Overlay priorities|the overlay article]].

The file <code>/var/lib/layman/installed.xml</code> contains some information about the overlays, among which is the priority attribute in the repo tag. The number there determines only the priority relative to the other overlay entries, 50 is the default value. [[Layman|layman]] then analyses this file and sets the order of the overlay entries in the <code>PORTDIR_OVELRAY</code> variable defined in <code>/var/lib/layman/make.conf</code>.

As the file <code>/var/lib/layman/make.conf</code> is automatically generated by layman based on the settings in <code>/var/lib/layman/installed.xml</code>, it is strongly recommended that only <code>/var/lib/layman/installed.xml</code> is used to set the priorities.

Because layman generates the <code>PORTDIR_OVERLAY</code> variable in <code>/var/lib/layman/make.conf</code> which in such a way that the <code>PORTDIR_OVERLAY</code> variable from <code>/etc/portage/make.conf</code> is put at the end, all overlays defined in <code>/etc/portage/make.conf</code> take precedence over those defined by layman, provided the <code>PORTDIR_OVERLAY</code> variable is defined in <code>/etc/portage/make.conf</code> ''before'' <code>/var/lib/layman/make.conf</code> is sourced.
{{File|/var/lib/layman/make.conf|Example layman overlays setting|<pre>
PORTDIR_OVERLAY="
/var/lib/layman/gamerlay
/var/lib/layman/lisp
/var/lib/layman/Spring
$PORTDIR_OVERLAY" #the variable defined in /etc/portage/make.conf is now expanded
                  #when /var/lib/layman/make.conf is sourced in /etc/portage/make.conf
</pre>}}


However, this can be also "fooled" by defining the <code>PORTDIR_OVERLAY</code> in <code>/etc/portage/make.conf</code> ''after'' you source <code>/var/lib/layman/make.conf</code>

{{File|/etc/portage/make.conf|Custom overlay setting|<pre>
source /var/lib/layman/make.conf #this sources the PORTDIR_OVERLAY variable defined by layman.
                                 #however, the variable expanded by layman was empty
PORTDIR_OVERLAY="/home/user/overlay ${PORTDIR} ${PORTDIR_OVERLAY}" #now the layman defined overlays take precedence,
                                                                   #but the user defined overlay still has the lowest priority </pre>}}
This "trick" is merely an opportunity offered by shell variable expansion.

===Adding custom overlays===
If you want to add overlays which are not listed when you run <code>layman -L</code> you can do it by editing the file <code>/etc/layman/layman.cfg</code>. If you haven't made any change to that file before, you should have a line like this one:

{{File|/etc/layman/layman.cfg|Overlay list setting|<pre>overlays  : http://www.gentoo.org/proj/en/overlays/repositories.xml</pre>}}

You have to add a new line after that line pointing to an xml file which contains the list of your custom overlays. Don't forget the <code>file://</code> at the beginning of the line. An example could be this one:

{{File|/etc/layman/layman.cfg|Overlay list setting|<pre>
overlays  : http://www.gentoo.org/proj/en/overlays/repositories.xml
            file:///var/lib/layman/my-list.xml</pre>}}

Now you have to edit the file <code>/var/lib/layman/my-list.xml</code> (in case you have followed the example) and add your custom overlays there. Here is an example:

{{File|/var/lib/layman/my-list.xml|Custom overlays list|<pre>
<?xml version="1.0" ?>                                                                                                     
<repositories version="1.0">
	<repo priority="50" quality="experimental" status="unofficial">
		<name>sarnold</name>
		<description>Custom stuff for PPC from sarnold.</description>
		<homepage>http://github.com/sarnold/</homepage>
		<owner>
			<email>sarnold@gentoo.org</email>
		</owner>
		<source type="git">git://github.com/sarnold/portage-overlay.git</source>
	</repo>
</repositories>
</pre>}}

When finished just run <code>layman -f -a sarnold</code> (change sarnold with the name of the repository you want to add).

==See also==
* [http://www.gentoo.org/proj/en/overlays/userguide.xml Gentoo Overlay's: Users Guide] on Gentoo.org

== External resources ==
* [http://layman.sourceforge.net/ Layman Homepage] on Sourceforge.net


[[Category:Portage tools]]
