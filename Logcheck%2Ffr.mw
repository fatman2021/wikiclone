<languages />

Ce guide vous explique comment analyser les journaux système avec logcheck.

== Démarrer avec logcheck ==

=== Arrière-plan ===

<code>logcheck</code> est une mise à jour de  <code>logsentry</code> (du paquet <code>sentrytools</code> ). C'est un outil qui permet d'analyser les journaux système. En prime,<code>logcheck</code> est fourni avec base de données interne de messages de journaux sans intérêt dans le but de filtre le bruit. L'idée générale de l'outil est que tous les messages sont dignes d'intérêt, sauf ceux qui sont explicitement marqués comme étant du bruit.  <code>logcheck</code> vous adresse périodiquement un courriel avec un résumé des messages intéressants. 

=== Installer logcheck ===

{{Important|Il est vivement recommandé de retirer ''logsentry'' s'il est installé sur votre système. De plus, vous devriez retirer ''/etc/logcheck'' pour éviter des problèmes d'autorisation d'accès et de collision de fichiers. }}

{{RootCmd|emerge -c logsentry}}

{{RootCmd|rm -rf /etc/logcheck}}

Vous pouvez maintenant procéder à l'installation de ''logcheck''. 

{{Emerge|app-admin/logcheck}}

=== Configuration de base ===

<code>logcheck</code> crée un utilisateur séparé "logcheck" pour éviter d'être exécuté en tant que ''root''. En réalité, il refuserait de tourner en tant que ''root''. Pour l'autoriser à analyser les journaux, vous devez vous assurer qu'ils sont lisibles par ''logcheck''. Voici un exemple pour <code>syslog-ng</code> : 

{{Code|/etc/syslog-ng/syslog-ng.conf snippet|<pre>
options {
        owner(root);
  
        ## (Make log files group-readable by logcheck)
        group(logcheck);
        perm(0640);
};
</pre>
}}

Maintenant rechargez la configuration et assurez-vous que les changements fonctionnent comme vous l'espérez. 

{{RootCmd|/etc/init.d/syslog-ng reload
|ls -l /var/log/messages|output=<pre>
-rw-r----- 1 root logcheck 1694438 Feb 12 12:18 /var/log/messages
</pre>
}}

Vous devriez maintenant ajuster quelques réglages de base de <code>logcheck</code> dans  {{Path|/etc/logcheck/logcheck.conf}}. 

{{Code|Configuration de base de  /etc/logcheck/logcheck.conf |<pre>
# Contrôle le niveau de filtrage :
# Peut être défini à  "workstation", "server" ou "paranoid" pour différents
# niveaux de filtrage . Prend la valeur  ''server'' par défaut.
## (Le niveau ''workstation'' inclut ''server'' et  ''server'' inclut ''paranoid''.
Le niveau  ''paranoid'' ne filtre pratiquement aucun message.)
REPORTLEVEL="server"
  
# Contrôle à qui sont adressés les mails:
# *NOTE* le script ne définit pas de valeur par défaut pour cette variable !
# Devrait être définie comme un site extérieur,  "emailaddress@some.domain.tld"
## (Assurez-vous que vous pouvez recevoir les  e-mails de logcheck. Le test est vivement recommandé)
SENDMAILTO="root"
  
# Contrôle si  ''syslog-summary'' est exécuté pour chacune des sections.
# En alternative, définissez-le  à "1" pour activer un résumé supplémentaire.
# HINT: ''syslog-summary'' doit être installé.
## (Si vous obtenez beaucoup de messages identiques, vous pouvez installer  ''app-admin/syslog-summary'' et activer cette option.)
SYSLOGSUMMARY=0
</pre>
}}

Vous devez aussi dire à <code>logcheck</code>  quels journaux analyser  ( {{Path|/etc/logcheck/logcheck.logfiles}} ). 

{{Code|Configuration de base de  /etc/logcheck/logcheck.logfiles |<pre>
## (Ceci est un exemple pour  syslog-ng)
/var/log/messages
</pre>
}}

Pour terminer, activez la tâche programmée pour exécuter ''logcheck''. 

{{RootCmd|nano -w /etc/cron.hourly/logcheck.cron}}

{{Note|For more information about cron read the [https://wiki.gentoo.org/wiki/Cron Cron Guide] .}}

Congratulations! Now you will be regularly getting important log messages by email. An example message looks like this: 

{{Code|Example logcheck message|<pre>
System Events
=-=-=-=-=-=-=
Feb 10 17:13:53 localhost kernel: [30233.238342] conftest[25838]: segfault at 40 ip 40061403 sp bfc443c4 error 4
in libc-2.10.1.so[4003e000+142000]
Feb 11 12:31:21 localhost postfix/pickup[18704]: fatal: could not find any active network interfaces
Feb 11 12:31:22 localhost postfix/master[3776]: warning: process //usr/lib/postfix/pickup pid 18704 exit status 1
Feb 11 12:31:22 localhost postfix/master[3776]: warning: //usr/lib/postfix/pickup: bad command startup -- throttling
</pre>
}}

== Troubleshooting ==

=== General tips ===

You can use the logcheck's <code>-d</code> switch to display more debugging information. Example: 

{{RootCmd|su -s /bin/bash -c '/usr/sbin/logcheck -d' logcheck|output=<pre>
D: [1281318818] Turning debug mode on
D: [1281318818] Sourcing - /etc/logcheck/logcheck.conf
D: [1281318818] Finished getopts c:dhH:l:L:m:opr:RsS:tTuvw
D: [1281318818] Trying to get lockfile: /var/lock/logcheck/logcheck.lock
D: [1281318818] Running lockfile-touch /var/lock/logcheck/logcheck.lock
D: [1281318818] cleanrules: /etc/logcheck/cracking.d/kernel
...
D: [1281318818] cleanrules: /etc/logcheck/violations.d/su
D: [1281318818] cleanrules: /etc/logcheck/violations.d/sudo
...
D: [1281318825] logoutput called with file: /var/log/messages
D: [1281318825] Running /usr/sbin/logtail2 on /var/log/messages
D: [1281318825] Sorting logs
D: [1281318825] Setting the Intro
D: [1281318825] Checking for security alerts
D: [1281318825] greplogoutput: kernel
...
D: [1281318825] greplogoutput: returning 1
D: [1281318825] Checking for security events
...
D: [1281318825] greplogoutput: su
D: [1281318825] greplogoutput: Entries in checked
D: [1281318825] cleanchecked - file: /tmp/logcheck.uIFLqU/violations-ignore/logcheck-su
D: [1281318825] report: cat'ing - Security Events for su
...
D: [1281318835] report: cat'ing - System Events
D: [1281318835] Setting the footer text
D: [1281318835] Sending report: 'localhost 2010-08-09 03:53 Security Events' to root
D: [1281318835] cleanup: Killing lockfile-touch - 17979
D: [1281318835] cleanup: Removing lockfile: /var/lock/logcheck/logcheck.lock
D: [1281318835] cleanup: Removing - /tmp/logcheck.uIFLqU
</pre>
}}

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:


* phajdan.jr
* nightmorph
