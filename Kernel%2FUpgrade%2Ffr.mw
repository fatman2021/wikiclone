<languages />

Cet article décrit les différentes étapes de la mise à jour vers un nouveau [[kernel/fr|noyau]].

== Installation ==

Une mise à jour du noyau peut être nécessaire lorsque les nouvelles sources du noyau sont installées suite à une mise à jour du système où lorsque vous installez vous-même les nouvelles sources.

== Configuration ==

La configuration décrite ici, respecte l'ordre des étapes décrites dans la [[Kernel/Configuration/fr|configuration manuelle]], mais seul le fichier de configuration est réutilisé. Toutes les étapes sont mentionnées à nouveau ici par souci de complétude. Pour une explication plus détaillée reportez-vous à l'autre article.

=== Mettre en place le lien symbolique ===

Le lien symbolique {{Path|/usr/src/linux}} devrait toujours pointer sur les sources du noyau en cours d'utilisation. Il y a trois manières d'arriver à ce résultat :

; 1. Installer les sources du noyau avec l'[[USE flag| option de la variable USE]] ''symlink'' activée.
: Ceci fera que le lien symbolique {{Path|/usr/src/linux}} pointera sur vos sources nouvellement installées. Si nécessaire, il pourra toujours être modifié par la suite en suivant l'une de ces deux méthodes :

; 2. Setting the symlink with '''eselect''':

: {{RootCmd| eselect kernel list |
  |output=Available kernel symlink targets:<br /> &nbsp; [1] linux-3.3.8-gentoo *<br /> &nbsp; [2]   linux-3.4.9-gentoo}}

: This outputs the available kernel sources. The asterisk indicates the chosen sources. To change the kernel sources, e.g. to the second entry, do:

: {{RootCmd|eselect kernel set 2}}

; 3. Setting the symlink manually:

: {{RootCmd|ln -sf /usr/src/linux-3.4.9 /usr/src/linux |
  |ls -l /usr/src/linux |
  |output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo}}

=== Sanitize sources ===
If you just want to rebuild the current kernel, you need sometimes to sanitize the kernel sources:
{{RootCmd|make distclean}}

=== Copy previous kernel configuration ===
The configuration from currently running kernel needs to be copied to the new one. It can be found in several places:

* In the [[procfs]] filesystem, if the kernel option ''Kernel .config support'' was activated in your present kernel:

: {{RootCmd|zcat /proc/config.gz > /usr/src/linux/.config}}

* In the {{Path|/boot}} directory, if you installed the config file there:

: {{RootCmd|cp /boot/config-3.3.8-gentoo /usr/src/linux/.config}}

* In the kernel directory of the currently-running kernel:

: {{RootCmd|cp /usr/src/linux-3.3.8-gentoo/.config /usr/src/linux/}}

=== make oldconfig ===
Now update the previous config file for your new kernel:

{{RootCmd|cd /usr/src/linux
|make oldconfig}}

The following configuration parallels that of the text based configuration with '''make config'''. For every difference between the kernel versions, it asks if you want to activate the driver or feature. An example:

{{RootCmd|make oldconfig
|output=Anticipatory I/O scheduler (IOSCHED_AS) [Y/n/m/?] (NEW)
}}

The string ''(NEW)'' at the end of the line marks this option as new. Left to the string in square brackets are the possible answers: ''Y''es, ''n''o, ''m''odule or ''?'' to show the help. The recommend answer is capitalized (here ''Y''). The help explains the option or driver.

Unfortunately '''make oldconfig''' doesn't show - next to the help - a lot more information for each option, like the context, so that it is sometimes difficult to give the right answer. In this case the best way to go is to remember the option name and revise it afterwards through one of the [[Kernel/Configuration#Configuration tools|graphical kernel configuration tools]].

== Reinstall external kernel modules ==

Any external kernel modules, such as [[:Category:Binary kernel modules|binary kernel modules]], need to be rebuilt for each new kernel. If the kernel hasn't been built yet, it has to first be prepared for the building of the external kernel modules:

{{RootCmd|make modules_prepare}}

You can rebuild the packages using the ''@module-rebuild'' set:

{{Emerge|@module-rebuild}}

== Build ==

For this step, follow the steps in the [[Kernel/Configuration#Build|manual configuration]] article.

== Removing old kernels ==

See the [[Kernel/Removal|kernel removal]] article. 

== External resources ==

* [http://kernelnewbies.org/LinuxChanges kernel changelog with some explanations of new features]

[[Category:Kernel]]
