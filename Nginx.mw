{{Lowercase title}}
{{InfoBox stack
|{{InfoBox homepage|http://nginx.org/en/|header=true}}
|{{InfoBox wikipedia}}
}}
'''nginx''' is a robust, small and high performance [[:Category:Web Servers|web server]] and reverse proxy server. It is a good alternative to the popular available web servers like [[Apache]] and [[lighttpd]].

== Installation ==
Install {{Package|www-servers/nginx}}:
{{Emerge|nginx}}

=== USE flags ===
{{USEflag|package=www-servers/nginx
|aio
|debug
|http+yes
|http-cache+yes
|ipv6+yes
|libatomic 
|pcre
|pcre-jit
|syslog 
|vim-syntax
|ssl+yes
|NGINX_MODULES_HTTP+++See {{Path|[http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/profiles/desc/nginx_modules_http.desc /usr/portage/profiles/desc/nginx_modules_http.desc]}}. Enable in your {{Path|make.conf}}.
|NGINX_MODULES_MAIL+++See {{Path|[http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/profiles/desc/nginx_modules_mail.desc /usr/portage/profiles/desc/nginx_modules_mail.desc]}}. Enable in your {{Path|make.conf}}.
}}

Add nginx to the default runlevel:
{{RootCmd|rc-update add nginx default}}

== Configuration ==
The nginx configuration is handled by {{Path|/etc/nginx/nginx.conf}}. 
Example 1 shows a single-site access, without dynamic capabilities (such as [[PHP]]).

{{File|/etc/nginx/nginx.conf|Example 1 - Gentoo's default configuration|<pre>
user nginx nginx;
worker_processes 1;

error_log /var/log/nginx/error_log info;

events {
        worker_connections 1024;
        use epoll;
}

http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        log_format main
                '$remote_addr - $remote_user [$time_local] '
                '"$request" $status $bytes_sent '
                '"$http_referer" "$http_user_agent" '
                '"$gzip_ratio"';

        client_header_timeout 10m;
        client_body_timeout 10m;
        send_timeout 10m;

        connection_pool_size 256;
        client_header_buffer_size 1k;
        large_client_header_buffers 4 2k;
        request_pool_size 4k;

        gzip on;
        gzip_min_length 1100;
        gzip_buffers 4 8k;
        gzip_types text/plain;

        output_buffers 1 32k;
        postpone_output 1460;

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;

        keepalive_timeout 75 20;

        ignore_invalid_headers on;

        index index.html;

        server {
                listen 127.0.0.1;
                server_name localhost;

                access_log /var/log/nginx/localhost.access_log main;
                error_log /var/log/nginx/localhost.error_log info;

                root /var/www/localhost/htdocs;
        }
}
</pre>}}

Start nginx:
{{RootCmd|/etc/init.d/nginx start}}

Verify nginx is running and responding as configured above:
{{Cmd|curl http://localhost}}

=== Enabling PHP support  ===
Add following lines to your nginx configuriation to enable PHP support. In this example nginx is exchanging information with the PHP process via a UNIX socket.
{{File|/etc/nginx/nginx.conf|Example 2 - Enabling PHP support|<pre>
...
http {
...
    server { 
    ...
            location ~ \.php$ {
                       include /etc/nginx/fastcgi.conf;
                       fastcgi_pass unix:/var/run/php-fpm.socket;
           }
    }
}
</pre>}}

Additionally it is needed to build [[PHP]] with FastCGI Process Manager (php-fpm) support enabled.
Add the fpm USE flag to the {{Package|dev-lang/php}} package: 
{{RootCmd|echo "dev-lang/php fpm" >> /etc/portage/package.use}}

Rebuild php with the new USE flag enabled.
{{emerge|dev-lang/php}}
 
{{Note|Using UNIX socket communication is the preferred and recommended configuration}}
Review the {{Path|/etc/php/fpm-php5.4/php-fpm.conf}} configuration, add following line:
{{File|/etc/php/fpm-php5.4/php-fpm.conf|Example 3 - Running PHP with UNIX socket support|<pre>
...
listen = /var/run/php-fpm.socket
...
</pre>}}

Start the php-fpm daemon:
{{RootCmd|/etc/init.d/php-fpm start}}

Add php-fpm to the default runlevel 
{{RootCmd|rc-update add php-fpm default}}

Reload nginx with changed configuration
{{RootCmd|/etc/init.d/nginx reload}}

=== IP access list ===
Example 4 shows how to allow access to a particular site ''/nginx_status'' only to 
* certain hosts f.e. ''192.0.2.1 127.0.0.1''
* and IP networks ''198.51.100.0/24''
IP addresses are in CIDR notation, see definition example below:
{{File|/etc/nginx/nginx.conf|Example 4 - Enabling and configuring an IP access lists for /nginx_status page|<pre>
...
http{
...
    server { 
    ...
            location /nginx_status {
                     stub_status on;
                     allow 127.0.0.1/32;
                     allow 192.0.2.1/32;
                     allow 198.51.100.0/24;
                     deny all;
             }
     }
}
</pre>}}

== Troubleshooting ==
Get general information using following troubleshooting commands.

Verify the running nginx configuration has no errors, nginx will only test '''-t''' the configuration without starting the process:
{{RootCmd|/usr/sbin/nginx -t|output=<pre>
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
</pre>}}

Check if the nginx process is running:
{{Cmd|ps aux {{!}} egrep 'nginx{{!}}PID'|output=<pre>
  PID TTY      STAT   TIME COMMAND
26092 ?        Ss     0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
26093 ?        S      0:00 nginx: worker proces
</pre>}}

Verify nginx daemon is listening on TCP port 80:
{{RootCmd|netstat -tulpen {{!}} grep :80|output=<pre>
tcp        0      0 127.0.0.1:80            0.0.0.0:*               LISTEN      0          12336835   -26092/nginx: master
</pre>}}

== External resources ==
* [http://wiki.nginx.org/Main nginx Wiki][[Category:Web Servers]]
