MediaTomb is an open source (GPL) [[Wikipedia:Universal Plug and Play|UPnP]] MediaServer with a nice web user interface. It allows you to stream your digital media through your home network and access it on a variety of UPnP compatible devices.

== Installation ==

=== Kernel ===
MediaTomb supports [[Wikipedia:Inotify|Inotify]] which is a file-monitoring mechanism that allows MediaTomb to be notified about changes to files immediately. For more information, please consult Section 2.1.5 of the [http://mediatomb.cc/pages/userinterface MediaTomb User Interface] documentation.

You need to activate the following kernel options:
{{Kernel||<pre>
 File systems --->
   [*] Inotify support for userspace
</pre>}}

=== Software ===
Install {{Package|net-misc/mediatomb}}:
{{USEflag|package=net-misc/mediatomb
|debug++no
|exif+yes+yes
|ffmpeg+yes+yes
|inotify++yes
|javascript+yes+yes+Enables SpiderMonkey JavaScript engine support. Creates a virtual container layout based on the extracted metadata.
|lastfm
|libextractor++no+Enables audio, image and video metadata extraction support. Slows the media import speed considerably.
|mp4+yes+yes+Enables MP4 metadata extraction support.
|mysql
|taglib+yes+yes
|thumbnail
}}

{{Emerge|mediatomb}}

== Configuration ==

=== Network ===
* To set the interface that MediaTomb binds to, add the following to the '''MEDIATOMB_OPTIONS''' variable.
{{File|/etc/conf.d/mediatomb||<pre>
MEDIATOMB_OPTIONS="-e eth0"
</pre>}}
* To set the IP address that MediaTomb binds to, add the following to the '''MEDIATOMB_OPTIONS''' variable.
{{File|/etc/conf.d/mediatomb||<pre>
MEDIATOMB_OPTIONS="-i 192.168.0.1"
</pre>}}

=== MySQL ===
{{Note|The {{Package|net-misc/mediatomb}} '''mysql''' USE flag needs to be enabled for [[MySQL]] support.}}
* To enable MySQL support, set the '''enabled''' attribute to '''yes''' for the '''<mysql>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
      <mysql enabled="yes">
</pre>}}

* Set the '''enabled''' attribute to '''no''' for the '''<sqlite3>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
      <sqlite3 enabled="no">
</pre>}}

* Set the '''<host>''', '''<database>''', '''<username>''' and '''<password>''' elements.
{{File|/etc/mediatomb/config.xml||<pre>
        <host>host</host>
        <database>database</database>
        <username>username</username>
        <password>password</password>
</pre>}}

* Login to MySQL and create the MediaTomb database and user, using the '''host''', '''database''', '''username''' and '''password''' values set in the MediaTomb configuration file.
{{Cmd
|CREATE DATABASE database;
|GRANT ALL ON database.* TO 'username'@'host' IDENTIFIED BY 'password';
|prompt=mysql>
|color=black
}}

=== Transcoding ===
MediaTomb allows you to transcode unsupported media files to formats that are supported by your UPnP device. The default Gentoo configuration file uses FFmpeg to transcode FLAC, Flash, Theora and Vorbis files. For more information, please consult section 6.3 of the [http://mediatomb.cc/pages/documentation MediaTomb] documentation.
* To enable transcoding support, set the '''enabled''' attribute to '''yes''' for the '''<transcoding>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
  <transcoding enabled="yes">
</pre>}}

* For every additional mimetype that requires transcoding, add the following section in between the '''<mimetype-profile-mappings>''' and '''</mimetype-profile-mappings>''' elements and substitute '''mimetype''' and '''profile''' with the appropriate values e.g. <transcode mimetype&#61;"'''video/quicktime'''" using&#61;"'''video2mpeg'''"/>
{{File|/etc/mediatomb/config.xml||<pre>
      <transcode mimetype="mimetype" using="profile">
</pre>}}

* Install {{Package|media-video/ffmpeg}}.
{{Note|The {{Package|media-video/ffmpeg}} '''encode''' USE flag needs to be enabled for transcoding support. If you want transcoding to take advantage of multithreading, the {{Package|media-video/ffmpeg}} '''threads''' USE flag needs to be enabled.}}
{{Emerge|ffmpeg}}

==== Alternative Transcoders ====
MediaTomb's transcoding support is very flexible and any application capable of transcoding can be used. For more information, please consult the [http://mediatomb.cc/pages/transcoding MediaTomb Transcoding] documentation.

===== VLC =====
----

'''Audio'''
* To enable VLC audio transcoding, replace the '''<agent>''' element for the '''audio2pcm''' profile with the following:
{{File|/etc/mediatomb/config.xml||<pre>
        <agent command="vlc" arguments="%in -I dummy --sout=#transcode{acodec=s16b,ab=192,samplerate=44100,channels=2}:standard{access=file,mux=raw,dst=%out} vlc://quit"/>
</pre>}}

* Set the '''<accept-url>''' element to '''yes''' for the '''audio2pcm''' profile.
{{File|/etc/mediatomb/config.xml||<pre>
        <accept-url>yes</accept-url>
</pre>}}

'''Video'''
* To enable VLC video transcoding, replace the '''<agent>''' element for the '''video2mpeg''' profile with the following:
{{File|/etc/mediatomb/config.xml||<pre>
        <agent command="vlc" arguments="%in -I dummy --sout=#transcode{vcodec=mp2v,vb=4096,fps=25,acodec=mpga,ab=192,samplerate=48000,channels=2,audio-sync}:standard{access=file,mux=ps,dst=%out} vlc://quit"/>
</pre>}}

* Set the '''<accept-url>''' element to '''yes''' for the '''video2mpeg''' profile.
{{File|/etc/mediatomb/config.xml||<pre>
        <accept-url>yes</accept-url>
</pre>}}

* Install {{Package|media-video/vlc}}.
{{Note|The {{Package|media-video/vlc}} '''ffmpeg''', '''encode''' and {{Package|media-video/ffmpeg}} '''encode''' USE flags need to be enabled for transcoding support.}}
{{Emerge|vlc}}

===== MPlayer =====
----

'''Video'''
* To enable MPlayer video transcoding, replace the '''<agent>''' element for the '''video2mpeg''' profile with the following.
{{File|/etc/mediatomb/config.xml||<pre>
        <agent command="mencoder" arguments="%in -o %out -ovc lavc -oac lavc -lavcopts vcodec=mpeg2video:vbitrate=4096:vrc_minrate=0:vrc_maxrate=9800:vrc_buf_size=1835:keyint=15:vstrict=0:acodec=mp2:abitrate=192 
-vf harddup -af lavcresample=48000:channels=2 -srate 48000 -ofps 25 -of mpeg -mpegopts format=mpeg2:tsaf"/>
</pre>}}

* Set the '''<accept-url>''' element to '''yes''' for the '''video2mpeg''' profile.
{{File|/etc/mediatomb/config.xml||<pre>
        <accept-url>yes</accept-url>
</pre>}}

* Install {{Package|media-video/mplayer}}.
{{Note|The {{Package|media-video/mplayer}} '''encode''' USE flag needs to be enabled for transcoding support.}}
{{Emerge|mplayer}}

=== DLNA ===
{{Note|MediaTomb doesn't implement the [[Wikipedia:Digital Living Network Alliance|DLNA]] specification and is not a DLNA media server. It does however offer basic support for some DLNA devices e.g. PlayStation 3.}}
* To enable DLNA support, set the '''extend''' attribute to '''yes''' for the '''<protocolInfo>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
    <protocolInfo extend="yes">
</pre>}}

* If you have a DLNA enabled TV (e.g. Samsung), add the following section in between the '''<server>''' and '''</server>''' elements.
{{File|/etc/mediatomb/config.xml||<pre>
    <custom-http-headers>
      <add header="transferMode.dlna.org: Streaming"/>
      <add header="contentFeatures.dlna.org: DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01500000000000000000000000000000"/>
    </custom-http-headers>
</pre>}}

=== Online Services ===
MediaTomb allows you to stream online content to your UPnP device from services such as [http://www.youtube.com/ YouTube]. For more information, please consult Section 6.2.1 of the [http://mediatomb.cc/pages/documentation MediaTomb] documentation.

==== YouTube ====
{{Warning|There are reports on the MediaTomb [http://sourceforge.net/projects/mediatomb/forums/forum/440751/topic/4013201 forum] indicating that YouTube support is currently broken.}}
{{Note|You need to specify the content you want to view, as the default Gentoo configuration file only provides a sample. For more information, please consult Section 6.2.2 of the [http://mediatomb.cc/pages/documentation MediaTomb] documentation.}}
* To enable YouTube support, set the '''enabled''' attribute to '''yes''' for the '''<YouTube>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
      <YouTube enabled="yes" refresh="28800" update-at-start="yes" purge-after="604800" racy-content="exclude" format="mp4" hd="no">
</pre>}}

* If you want to view YouTube videos in high definition (if available), set the '''hd''' attribute to '''yes''' for the '''<YouTube>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
      <YouTube enabled="yes" refresh="28800" update-at-start="yes" purge-after="604800" racy-content="exclude" format="mp4" hd="yes">
</pre>}}

* If your UPnP device doesn't support MP4 videos, enable [[#Transcoding|transcoding]] and add the following section in between the '''<mimetype-profile-mappings>''' and '''</mimetype-profile-mappings>''' elements.
{{File|/etc/mediatomb/config.xml||<pre>
      <transcode mimetype="video/mp4" using="video2mpeg"/>
</pre>}}

=== Video Thumbnails ===
{{Note|The {{Package|net-misc/mediatomb}} '''ffmpeg''' and '''thumbnail''' USE flags need to be enabled for video thumbnail support.}}
* To enable video thumbnail support, set the '''enabled''' attribute to '''yes''' for the '''<ffmpegthumbnailer>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
      <ffmpegthumbnailer enabled="yes">
</pre>}}

* If you want to overlay a filmstrip border on the generated thumbnail, set the '''<filmstrip-overlay>''' element to '''yes'''.
{{File|/etc/mediatomb/config.xml||<pre>
        <filmstrip-overlay>yes</filmstrip-overlay>
</pre>}}

* If you have a DLNA enabled device that supports video thumbnails (e.g. PlayStation 3), set the '''extend''' attribute to '''yes''' for the '''<protocolInfo>''' element.
{{File|/etc/mediatomb/config.xml||<pre>
    <protocolInfo extend="yes">
</pre>}}

=== Raw Images ===
* To enable (Canon CR2 and Nikon NEF) [http://en.wikipedia.org/wiki/Raw_image_format raw image] support, enable [[#Transcoding|transcoding]] and add the following section in between the '''<profile>''' and '''</profile>''' elements.
{{File|/etc/mediatomb/config.xml||<pre>
      <profile name="raw2jpeg" enabled="yes" type="external">
        <mimetype>image/jpeg</mimetype>
        <accept-url>no</accept-url>
        <first-resource>yes</first-resource>
        <hide-original-resource>yes</hide-original-resource>
        <use-chunked-encoding>no</use-chunked-encoding>
        <agent command="/usr/local/bin/mediatomb-raw2jpeg" arguments="%in %out"/>
        <buffer size="524288" chunk-size="512" fill-size="1024"/>
      </profile>
</pre>}}

* Add the following section in between the '''<mimetype-profile-mappings>''' and '''</mimetype-profile-mappings>''' elements.
{{File|/etc/mediatomb/config.xml||<pre>
      <transcode mimetype="image/raw" using="raw2jpeg"/>
</pre>}}

* For every additional raw image format (supported by [http://www.cybercom.net/~dcoffin/dcraw/ dcraw]), add the following section in between the '''<extension-mimetype ignore-unknown&#61;"no">''' and '''</extension-mimetype>''' elements and substitute '''extension''' with the appropriate value e.g. <map from&#61;"'''kdc'''" to&#61;"image/raw"/>
{{File|/etc/mediatomb/config.xml||<pre>
        <map from="extension" to="image/raw"/>
</pre>}}

* Create the following script.
{{File|/usr/local/bin/mediatomb-raw2jpeg||<pre>
#!/bin/sh

DCRAW_PATH="/usr/bin/dcraw"
INPUT="$1"
OUTPUT="$2"

exec "${DCRAW_PATH}" -e -c "${INPUT}" > "${OUTPUT}"
</pre>}}

* Install {{Package|media-gfx/dcraw}}.
{{Emerge|dcraw}}

== Starting ==
* To start MediaTomb.
{{RootCmd|/etc/init.d/mediatomb start}}
* To start MediaTomb at boot.
{{RootCmd|rc-update add mediatomb default}}

== Troubleshooting ==
=== Mimetype Mapping ===
{{Note|If you have added or changed a mimetype mapping after importing your content, you will need to re-import it as mimetype mappings are only set during import.}}
MediaTomb (via libmagic) can identify certain files with an incorrect mimetype. A common case is where videos with the '''mp4''' extension are identified as the mimetype '''audio/mp4'''. To override the mimetype returned by libmagic, add the following section in between the '''<extension-mimetype ignore-unknown&#61;"no">''' and '''</extension-mimetype>''' elements and substitute '''extension''' and '''mimetype''' with the appropriate values e.g. <map from&#61;"'''mp4'''" to&#61;"'''video/mp4'''"/>
{{File|/etc/mediatomb/config.xml||<pre>
        <map from="extension" to="mimetype">
</pre>}}

== External resources ==
* [http://mediatomb.cc/ MediaTomb]
* [http://mediatomb.cc/dokuwiki/faq:faq MediaTomb FAQ]

[[Category:Multimedia]]
